name: datashare 
base: core20
version: '10.15.3-beta0'
summary: Datashare is a self-hosted search engine for documents.
website: https://datashare.icij.org
description: |
  Datashare is a self-hosted search engine for documents, 
  using Apache Tika and Apache Tesseract to read hundreds
  of file formats. Datashare is developed by the 
  International Consortium of Investigative Journalists (ICIJ), 
  famously known for its groundbreaking investigations
  into the offshore world (Pandora Papers, Panama Papers, etc).
grade: stable
confinement: classic

parts:
  datashare:
    plugin: dump
    source: https://github.com/ICIJ/datashare-installer/releases/download/$SNAPCRAFT_PROJECT_VERSION/datashare-$SNAPCRAFT_PROJECT_VERSION.tgz
    stage-packages:
      - openjdk-11-jre
      - tesseract-ocr
      - ca-certificates-java
    build-packages:
      - ca-certificates-java
    override-build: |
      mv $SNAPCRAFT_PART_INSTALL/usr/lib/jvm/java-11-openjdk-* $SNAPCRAFT_PART_INSTALL/usr/lib/jvm/java-11-openjdk
      rm -f $SNAPCRAFT_PART_INSTALL/usr/lib/jvm/java-11-openjdk/lib/security/blacklisted.certs
      snapcraftctl build
    override-prime: |
      snapcraftctl prime
      chmod +x datashare

apps:
  datashare:
    command: datashare
    environment:
      DATASHARE_HOME: $SNAP_USER_COMMON
      DATASHARE_JAR: $SNAP/datashare-dist-$SNAPCRAFT_PROJECT_VERSION-all.jar
      JAVA_HOME: "$SNAP/usr/lib/jvm/java-11-openjdk"
      JAVA_BIN: "$JAVA_HOME/bin/java"
      PATH: "$SNAP/bin:$JAVA_HOME/bin:$PATH"
